<div class="container-fluid dashboard-container p-4">
    <!-- Header -->
    <div class="mb-4">
        <h2 class="fw-bold text-dark section-title mb-1">
            Find Trips
        </h2>
        <p class="text-muted mb-0">Browse available transport jobs and bid on high-value tours.</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-teal" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Tours Grid -->
    <div class="row g-4" *ngIf="!isLoading">

        <!-- No Tours -->
        <div *ngIf="tours.length === 0" class="col-12 text-center py-5">
            <div class="p-5 bg-white shadow-sm rounded-4">
                <i class="bi bi-geo-alt-fill fs-1 text-muted opacity-25"></i>
                <h5 class="mt-3 text-muted">No open tours found.</h5>
                <p class="text-muted mb-0">Check back later for new transport opportunities.</p>
            </div>
        </div>

        <div class="col-xl-6" *ngFor="let tour of tours">
            <div class="card h-100 border-0 shadow-sm overflow-hidden job-card rounded-4">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <span class="badge bg-primary-subtle text-primary border border-primary-subtle px-3 py-2">
                            <i class="bi bi-truck me-1"></i> Transport
                        </span>
                        <span class="badge bg-light text-dark border px-3 py-2">Open for Offers</span>
                    </div>

                    <h5 class="fw-bold text-dark mb-2">{{ tour.title }}</h5>
                    <div class="d-flex flex-wrap gap-3 mb-3">
                        <p class="text-muted small mb-0">
                            <i class="bi bi-geo-alt-fill text-teal me-1"></i>
                            {{ tour.departureLocation }} <i class="bi bi-arrow-right mx-1"></i> {{ tour.destination }}
                        </p>
                        <p class="text-muted small mb-0">
                            <i class="bi bi-calendar me-1"></i>
                            {{ formatDate(tour.startDate) }} - {{ formatDate(tour.endDate) }}
                        </p>
                    </div>

                    <div class="d-flex gap-4 mb-3 p-3 bg-light rounded-3">
                        <div>
                            <span class="text-muted d-block small">Capacity</span>
                            <span class="fw-bold"><i class="bi bi-people me-1"></i> {{ tour.maxCapacity }} Pax</span>
                        </div>
                        <div class="border-start ps-4">
                            <span class="text-muted d-block small">Duration</span>
                            <span class="fw-bold"><i class="bi bi-clock me-1"></i> {{ tour.durationDays }} Days</span>
                        </div>
                    </div>

                    <div class="mt-auto pt-3 border-top d-flex justify-content-between align-items-center">
                        <div>
                            <span class="text-muted small d-block">Est. Tour Budget</span>
                            <span class="fw-bold text-teal fs-5">PKR {{ tour.pricePerHead | number }}</span>
                        </div>
                        <button class="btn btn-teal text-white fw-bold px-4 py-2 rounded-3 shadow-sm hover-up"
                            (click)="openOfferModal(tour)">
                            Make Offer
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Overlay -->
<div class="modal-overlay" *ngIf="selectedTour" (click)="closeOfferModal()">
    <div class="modal-content-wrapper p-4 animate-slide-up" (click)="$event.stopPropagation()">

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-start mb-4">
            <div>
                <h4 class="fw-bold text-dark mb-1">Place Your Bid</h4>
                <p class="text-muted small mb-0">{{ selectedTour.title }} ({{ selectedTour.destination }})</p>
            </div>
            <button class="btn btn-sm btn-light border-0 text-muted rounded-circle" (click)="closeOfferModal()">
                <i class="bi bi-x fs-4"></i>
            </button>
        </div>

        <!-- Inputs -->
        <div class="row g-3">
            <div class="col-12">
                <label class="form-label fw-bold text-dark small">Select Vehicle</label>
                <select class="form-select" [(ngModel)]="selectedVehicleId" *ngIf="vehicles.length > 0">
                    <option *ngFor="let v of vehicles" [value]="v.vehicleId">
                        {{ v.registrationNumber }} - {{ v.model }} (Cap: {{ v.capacity }})
                    </option>
                </select>
                <div *ngIf="vehicles.length === 0" class="alert alert-warning small py-2 mt-1">
                    <i class="bi bi-exclamation-triangle me-1"></i> No active vehicles found. Please add a vehicle in
                    your profile first.
                </div>
            </div>
            <div class="col-12">
                <label class="form-label fw-bold text-dark small">Your Bid Amount (PKR)</label>
                <div class="input-group">
                    <span class="input-group-text bg-light border-end-0">PKR</span>
                    <input type="number" class="form-control border-start-0" [(ngModel)]="offerPrice"
                        placeholder="e.g. 45000">
                </div>
            </div>
            <div class="col-12">
                <label class="form-label fw-bold text-dark small">Additional Notes / Route Plan</label>
                <textarea class="form-control" rows="3" [(ngModel)]="offerDescription"
                    placeholder="I have a 2024 Model Coaster with dual AC..."></textarea>
            </div>
        </div>

        <!-- Actions -->
        <div class="d-flex gap-3 mt-4">
            <button class="btn btn-outline-secondary w-100 fw-bold py-2 rounded-3" (click)="closeOfferModal()">
                Cancel
            </button>
            <button class="btn btn-teal w-100 fw-bold py-2 rounded-3 text-white shadow-sm" (click)="submitOffer()"
                [disabled]="!offerPrice || !selectedVehicleId">
                Submit Bid
            </button>
        </div>

    </div>
</div>